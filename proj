#!/usr/bin/env fish
cd (status dirname)
switch $argv[1]
case -r
<<<<<<< HEAD
    set unit $argv[2]
    test "$unit" = "" && set unit adder
    
	set err (mktemp)
	if ghdl -a src/{processor, */*}.vhd test/$unit.vhd 2>$err && ghdl -e testbench 2>$err
		./testbench
		rm testbench
	else
		set f (head -n1 $err | string match -r '^[^:\n*]+')
		set loc (head -n1 $err | string match -r '(?<=)\d+:\d+')
		cat $err
		rm $err
		if test -f $f
			sleep 1
			micro $f +$loc
		end
	end
	rm *.o *.cf
=======
    set err (mktemp)
    if ghdl -a package.vhd adder/*.vhd 2>$err && ghdl -e testbench 2>$err
        ./testbench
        rm testbench *.o *.cf
    else
        set f (head -n1 $err | string match -r '^[^:\n]+')
        set loc (head -n1 $err | string match -r '(?<=)\d+:\d+')
        cat $err
        rm $err
        sleep 1
        
        micro $f +$loc
    end
>>>>>>> 0d6033eb77c2b17cdc7bd130ceab2a704025bef0
case -s
	set msg $argv[2]
	git add **/*.vhd
	and git commit -m $msg
	and git push origin main
end
